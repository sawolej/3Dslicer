import*as THREE from"./node_modules/three/build/three.module.js";import{OrbitControls}from"./node_modules/three/examples/jsm/controls/OrbitControls.js";import{d1}from"./dane.js";let scene,camera,renderer,controls,layerSpacing=2;function getMaxVal(e){let n=-1/0;for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++)e[t][r]>n&&(n=e[t][r]);return n}function clearScene(){for(let e=scene.children.length-1;e>=0;e--){const n=scene.children[e];n instanceof THREE.Mesh&&(n.geometry.dispose(),n.material.dispose(),scene.remove(n))}}function addDataToScene(e){const n=getMaxVal(e)/11,t=new THREE.SphereGeometry(.4,8,8),r=new Float32Array(3*t.attributes.position.count);for(let e=0;e<r.length;e+=3)r[e]=1,r[e+1]=1,r[e+2]=1;t.setAttribute("color",new THREE.BufferAttribute(r,3));const o=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}),a=e.length*e[0].length*11,i=new THREE.InstancedMesh(t,o,a);let c=0;for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++)for(let o=Math.floor(e[t][r]/n);o<11;o++){const e=new THREE.Matrix4;e.setPosition(1.5*r,1.5*t,o*layerSpacing),i.setMatrixAt(c,e);const n=new THREE.Color;n.setHSL(o/11,1,.5),i.setColorAt(c,n),c++}scene.add(i)}function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera.position.set(50,-200,-300),camera.lookAt(scene.position),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),controls=new OrbitControls(camera,renderer.domElement),addDataToScene(d1,2),animate()}function animate(){requestAnimationFrame(animate),controls.update(),renderer.render(scene,camera)}document.getElementById("minusSpacing").addEventListener("click",(function(){clearScene(),layerSpacing+=10,addDataToScene(d1)})),document.getElementById("plusSpacing").addEventListener("click",(function(){clearScene(),layerSpacing-=10,addDataToScene(d1)})),init();